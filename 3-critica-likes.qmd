---
title: "Crítica dos dados de likes"
format: 
  html:
    toc: true
    toc-depth: 5
    toc-location: left
    embed-resources: true
execute: 
  cache: true
---

```{r}
#| label: setup
#| warning: false

library(tidyverse)
`%!in%` <- negate(`%in%`)
```

## Carregando dados

```{r}
#| label: carrega-likes

likes <- read_rds("Dados/likes.rds")
liker.actors <- read_rds("Dados/liker-actors.rds")
liked.actors <- read_rds("Dados/liked-actors.rds")
likes.actors <- read_rds("Dados/likes-actors.rds")
```


## Criticando lista de likers

```{r}
liker.actors |> 
  group_by(from.handle == "handle.invalid") |> 
  summarise(quantos = n())
```

`r sum(liker.actors$from.handle == "handle.invalid")` actors não tềm mais handles válidos, então esses actors serão agrupados erradamente como um único actor se agrupar por handle.

Dos `r liker.actors |> nrow()` actors que curtiram skeets com "cblol" e  `r liked.actors |> length()` actors postaram skeets com "cblol" que foram curtidos, `r c(liker.actors$from.actor, liked.actors) |> unique() |> length()` curtiram e foram curtidos e `r setdiff(liker.actors$from.actor, liked.actors) |> length()` curtiram mas não foram curtidos e `r setdiff(liked.actors, liker.actors$from.actor) |> length()` foram curtidos mas não curtiram.

## Vendo se falta algum actor

## Lendo skeets

```{r}
#| label: confere-actors

skeets <- read_rds("Dados/skeets-curto.rds")
all.actors <- 
  c(
    skeets$did.autor,
    skeets$uri.reply |> 
      str_remove("^at://") |> 
      str_remove("/app.bsky.feed.post/.*$") 
  ) |> 
  unique() |> 
  sort()
likes.actors <- 
  c(liker.actors$from.actor, liked.actors) |> 
  unique() |> 
  sort()
any(all.actors %!in% likes.actors)
any(likes.actors %!in% all.actors)
```

Há `r skeets$uri.reply |> str_remove("^at://") |> str_remove("/app.bsky.feed.post/.*$") |> unique() |> setdiff(likes.actors) |> length()` autores de skeets que receberam replies curtidos que não estão nos likes


