---
title: "Crítica dos dados de likes"
format: 
  html:
    toc: true
    toc-depth: 5
    toc-location: left
    embed-resources: true
execute: 
  cache: true
---

```{r}
#| label: setup
#| warning: false

library(tidyverse)
`%!in%` <- negate(`%in%`)
options(scipen = 99)
```

## Carregando dados

```{r}
#| label: carrega-likes

likes <- read_rds("Dados/likes.rds")
liker.actors <- read_rds("Dados/liker-actors.rds")
liked.actors <- read_rds("Dados/liked-actors.rds")
likes.actors <- read_rds("Dados/likes-actors.rds")
```


## Criticando lista de likers

```{r}
liker.actors |> 
  group_by(from.handle == "handle.invalid") |> 
  summarise(quantos = n())
```

`r sum(liker.actors$from.handle == "handle.invalid")` actors não têm mais handles válidos, então esses actors serão agrupados erradamente como um único actor se agrupar por handle.

```{r}
likes.liker.liked <- 
  tibble(
    actor = 
      c(liker.actors$from.actor, liked.actors) |> 
      unique() |> 
      sort()
  ) |> 
  mutate(
    curtiu = actor %in% liker.actors$from.actor,
    foi.curtido = actor %in% liked.actors
  ) |> 
  with(table(curtiu, foi.curtido)) |> 
  addmargins()
likes.liker.liked
```

Dos `r likes.liker.liked[2,3]` actors que curtiram skeets com "cblol" e dos `r likes.liker.liked[3,2]` actors postaram skeets com "cblol" que foram curtidos, `r likes.liker.liked[2,2]` curtiram e foram curtidos e `r likes.liker.liked[2,1]` curtiram mas não foram curtidos e `r likes.liker.liked[1,2]` foram curtidos mas não curtiram.

## Vendo se falta algum actor

Lendo skeets

```{r}
#| label: confere-actors

skeets <- read_rds("Dados/skeets-curto.rds")
all.actors <- 
  c(
    skeets$did.autor,
    skeets$uri.reply |> 
      str_remove("^at://") |> 
      str_remove("/app.bsky.feed.post/.*$") 
  ) |> 
  unique() |> 
  sort()
likes.actors <- 
  c(liker.actors$from.actor, liked.actors) |> 
  unique() |> 
  sort()
any(all.actors %!in% likes.actors)
any(likes.actors %!in% all.actors)
```

Há `r skeets$uri.reply |> str_remove("^at://") |> str_remove("/app.bsky.feed.post/.*$") |> unique() |> setdiff(likes.actors) |> length()` autores de skeets que receberam replies curtidos que não estão nos likes


